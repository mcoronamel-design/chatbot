 <!DOCTYPE html>
<html lang="pt-BR">
  <body style="font-family: Arial; background:#111; color:#eee; padding:20px">
    <h2>Chatbot Tribut√°rio üí¨</h2>
    <div id="chat" style="background:#222; padding:15px; border-radius:10px; height:300px; overflow:auto; margin-bottom:10px"></div>
    <input id="msg" placeholder="Digite sua mensagem" style="width:80%; padding:8px; border-radius:6px; border:none">
    <button onclick="send()" style="padding:8px 15px; border:none; border-radius:6px; background:#2d6cdf; color:white; cursor:pointer;">Enviar</button>

    <script>
      // üîπ Gera ou recupera o ID de sess√£o para manter mem√≥ria
      const sessionKey = 'pl1087_session';
      let session = localStorage.getItem(sessionKey);
      if (!session) {
        session = crypto.randomUUID();
        localStorage.setItem(sessionKey, session);
      }

      async function send() {
        const msg = document.getElementById('msg').value.trim();
        if (!msg) return;

        const chatDiv = document.getElementById('chat');
        chatDiv.innerHTML += `<p><b>Voc√™:</b> ${msg}</p>`;
        document.getElementById('msg').value = '';

   try {
  const res = await fetch('https://gage-panurgic-uncontrastively.ngrok-free.dev/webhook/chatbot', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ question: msg })
  });

  if (!res.ok) throw new Error("Erro HTTP " + res.status);

  const text = await res.text();               // ‚Üê Recebe como texto
  const data = JSON.parse(text);               // ‚Üê Converte pra JSON
  const resposta = data.reply || "Sem resposta.";

  chatDiv.innerHTML += `<p><b>Bot:</b> ${resposta}</p>`;
  chatDiv.scrollTop = chatDiv.scrollHeight;

} catch (err) {
  chatDiv.innerHTML += `<p style="color:red"><b>Erro:</b> ${err.message}</p>`;
}

      }
    </script>
  </body>
</html>
